var Comm=function(target_name,comm_id){console.info("Comm: Init");this.target_name=target_name;this.comm_id=comm_id||utils.uuid();this._msg_callback=this._close_callback=null};Comm.prototype.open=function(data,callbacks,metadata){console.error("Comm.open is not implemented yet");return None};Comm.prototype.send=function(data,callbacks,metadata,buffers){console.error("Comm.send is not implemented yet");return None};Comm.prototype.close=function(data,callbacks,metadata){console.error("Comm.close is not implemented yet");return None};Comm.prototype._register_callback=function(key,callback){console.info("Comm: register_callback for "+key);this["_"+key+"_callback"]=callback};Comm.prototype.on_msg=function(callback){console.info("Comm: on_msg");this._register_callback("msg",callback)};Comm.prototype.on_close=function(callback){console.info("Comm: on_close");this._register_callback("close",callback)};Comm.prototype._callback=function(key,msg){console.info("Comm: _callback for "+key);var callback=this["_"+key+"_callback"];if(callback){try{callback(msg)}catch(e){console.log("Exception in Comm callback",e,e.stack,msg)}}};Comm.prototype.handle_msg=function(msg){console.info("Comm: handle_msg");this._callback("msg",msg)};Comm.prototype.handle_close=function(msg){console.info("Comm: handle_close");this._callback("close",msg)};var CommManager=function(kernel){console.info("CommManager: Init");this.kernel=kernel;this.comms={};this.targets={}};CommManager.prototype.new_comm=function(target_name,data,callbacks,metadata,comm_id){if(typeof comm_id==="undefined"){console.error("CommManager: new_comm with new comm_id not implemented yet");return}console.info("CommManager: new_comm target: "+target_name+" comm_id: "+comm_id);var comm=new Comm(target_name,comm_id);this.register_comm(comm);if(typeof comm_id==="undefined"){comm.open(data,callbacks,metadata)}return comm};CommManager.prototype.register_target=function(target_name,f){console.info("CommManager: register_target: "+target_name);this.targets[target_name]=f};CommManager.prototype.unregister_target=function(target_name,f){console.info("CommManager: unregister_target: "+target_name);delete this.targets[target_name]};CommManager.prototype.register_comm=function(comm){console.info("CommManager: register_comm comm_id: "+comm.comm_id);this.comms[comm.comm_id]=Promise.resolve(comm);comm.kernel=this.kernel;return comm.comm_id};CommManager.prototype.unregister_comm=function(comm){console.info("CommManager: unregister_comm comm_id: "+comm.comm_id);delete this.comms[comm.comm_id]};CommManager.prototype.comm_open=function(msg){console.error("CommManager.comm_open is not implemented yet");return None};CommManager.prototype.comm_close=function(msg){console.error("CommManager.comm_close is not implemented yet");return None};CommManager.prototype.comm_msg=function(msg){console.error("CommManager.comm_msg is not implemented yet");return None};var ZeppelinNotebookComm=function(kernel){console.info("ZeppelinNotebookComm: init");this.kernel=kernel};ZeppelinNotebookComm.prototype.handleMsg=function(data){if(data.task=="publish"){this.publish(data.msg.div_id,data.msg.html)}else if(data.task=="comm_open"){var msg=data.msg;this.kernel.comm_manager.new_comm(msg.target_name,msg.data,{},msg.metadata,msg.comm_id)}else if(data.task=="comm_close"){console.log("comm_close:");console.log(data)}else if(data.task=="comm_msg"){var msg=data.msg;this.kernel.comm_manager.comms[msg.comm_id].then(function(comm){comm.handle_msg({content:msg})})}else{console.error("UNHANDLED:"+JSON.stringify(data))}};ZeppelinNotebookComm.prototype.send=function(task,msg){console.info("ZeppelinNotebookComm: send "+task);this.zeppelinWS.send(JSON.stringify({notebook_id:this.notebookId,task:task,node:"notebook",msg:msg}))};ZeppelinNotebookComm.prototype.publish=function(div_id,html){console.info("ZeppelinNotebookComm: publish "+div_id);var counter=0;var retryId=setInterval(function(){div=document.getElementById(div_id);if(div!==null){clearInterval(retryId);div.innerHTML=html;scripts=div.getElementsByTagName("script");for(i in scripts){eval(scripts[i].innerHTML)}}if(counter==10){clearInterval(retryId)}},200)};var Kernel=function(notebook){console.info("Kernel: init");this.notebook=notebook;this.notebookComm=new ZeppelinNotebookComm(this);this.comm_manager=new CommManager(this)};Kernel.prototype.send_shell_msg=function(msg_type,content,callbacks,metadata,buffers){this.notebookComm.send(msg_type,content)};var Notebook=function(jupyter){console.info("Notebook: init");this.jupyter=jupyter;this.kernel=new Kernel(this)};
//# sourceMappingURL=jupytershim/js/jupyershim-min.js.map