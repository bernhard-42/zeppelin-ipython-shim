{"paragraphs":[{"text":"%pyspark\nimport sys\nsys.path += [\"/Users/bwalter/Development/_Spark_DataScience/zeppelin-ipython-shim\"]\n\nfrom jupytershim import JupyterShim\n","user":"anonymous","dateUpdated":"2017-02-25T11:27:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685947_611083456","id":"20170222-110000_685570517","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:27:12+0100","dateFinished":"2017-02-25T11:27:12+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:18556"},{"text":"%pyspark\n\njupyterReset()\nj = JupyterShim(zeppelinContext=z.z, debug=False)\n","user":"anonymous","dateUpdated":"2017-02-25T11:28:47+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685948_609159711","id":"20170218-215455_1576137953","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:28:47+0100","dateFinished":"2017-02-25T11:28:47+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18557"},{"text":"%pyspark\nfrom bokeh.io import push_notebook, show, output_notebook\nfrom bokeh.layouts import row\nfrom bokeh.resources import Resources\nfrom bokeh.plotting import figure\n\noutput_notebook()\n","user":"anonymous","dateUpdated":"2017-02-25T11:28:51+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685948_609159711","id":"20170218-224440_1753132708","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:28:51+0100","dateFinished":"2017-02-25T11:28:51+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18558"},{"text":"%pyspark\nfrom bokeh.charts import Bar, output_file, show\nfrom bokeh.charts.attributes import cat, color\nfrom bokeh.charts.operations import blend\nfrom bokeh.charts.utils import df_from_json\nfrom bokeh.sampledata.olympics2014 import data\n\n# utilize utility to make it easy to get json/dict data converted to a dataframe\ndf = df_from_json(data)\n\n# filter by countries with at least one medal and sort by total medals\ndf = df[df['total'] > 0]\ndf = df.sort(\"total\", ascending=False)\n\nbar = Bar(df,\n          values=blend('bronze', 'silver', 'gold', name='medals', labels_name='medal'),\n          label=cat(columns='abbr', sort=False),\n          stack=cat(columns='medal', sort=False),\n          color=color(columns='medal', palette=['SaddleBrown', 'Silver', 'Goldenrod'],\n                      sort=False),\n          legend='top_right',\n          title=\"Medals per Country, Sorted by Total Medals\",\n          tooltips=[('medal', '@medal'), ('country', '@abbr')])\n\n\nshow(bar)\n","user":"anonymous","dateUpdated":"2017-02-25T11:28:54+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685949_608774962","id":"20170221-202002_1864027574","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:28:54+0100","dateFinished":"2017-02-25T11:28:55+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18559"},{"text":"%pyspark\nfrom __future__ import print_function\n\nfrom bokeh.document import Document\nfrom bokeh.embed import file_html\nfrom bokeh.layouts import gridplot\nfrom bokeh.models.glyphs import Circle\nfrom bokeh.models import (BasicTicker, ColumnDataSource, Grid, LinearAxis,\n                         DataRange1d, PanTool, Plot, WheelZoomTool)\nfrom bokeh.resources import INLINE\nfrom bokeh.sampledata.iris import flowers\nfrom bokeh.util.browser import view\n\ncolormap = {'setosa': 'red', 'versicolor': 'green', 'virginica': 'blue'}\n\nflowers['color'] = flowers['species'].map(lambda x: colormap[x])\n\n\nsource = ColumnDataSource(\n    data=dict(\n        petal_length=flowers['petal_length'],\n        petal_width=flowers['petal_width'],\n        sepal_length=flowers['sepal_length'],\n        sepal_width=flowers['sepal_width'],\n        color=flowers['color']\n    )\n)\n\nxdr = DataRange1d(bounds=None)\nydr = DataRange1d(bounds=None)\n\ndef make_plot(xname, yname, xax=False, yax=False):\n    mbl = 40 if yax else 0\n    mbb = 40 if xax else 0\n    plot = Plot(\n        x_range=xdr, y_range=ydr, background_fill_color=\"#efe8e2\",\n        border_fill_color='white', plot_width=200 + mbl, plot_height=200 + mbb,\n        min_border_left=2+mbl, min_border_right=2, min_border_top=2, min_border_bottom=2+mbb)\n\n    circle = Circle(x=xname, y=yname, fill_color=\"color\", fill_alpha=0.2, size=4, line_color=\"color\")\n    r = plot.add_glyph(source, circle)\n\n    xdr.renderers.append(r)\n    ydr.renderers.append(r)\n\n    xticker = BasicTicker()\n    if xax:\n        xaxis = LinearAxis()\n        plot.add_layout(xaxis, 'below')\n        xticker = xaxis.ticker\n    plot.add_layout(Grid(dimension=0, ticker=xticker))\n\n    yticker = BasicTicker()\n    if yax:\n        yaxis = LinearAxis()\n        plot.add_layout(yaxis, 'left')\n        yticker = yaxis.ticker\n    plot.add_layout(Grid(dimension=1, ticker=yticker))\n\n    plot.add_tools(PanTool(), WheelZoomTool())\n\n    return plot\n\nxattrs = [\"petal_length\", \"petal_width\", \"sepal_width\", \"sepal_length\"]\nyattrs = list(reversed(xattrs))\nplots = []\n\nfor y in yattrs:\n    row = []\n    for x in xattrs:\n        xax = (y == yattrs[-1])\n        yax = (x == xattrs[0])\n        plot = make_plot(x, y, xax, yax)\n        row.append(plot)\n    plots.append(row)\n\ngrid = gridplot(plots)\n\nshow(grid)","user":"anonymous","dateUpdated":"2017-02-25T11:28:58+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685949_608774962","id":"20170221-201808_1127949177","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:28:58+0100","dateFinished":"2017-02-25T11:28:59+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18560"},{"text":"%pyspark\nimport numpy as np\nfrom scipy.integrate import odeint\n\nfrom bokeh.plotting import figure, show\n\nZBAK = z # Zeppelin bug\n\nsigma = 10\nrho = 28\nbeta = 8.0/3\ntheta = 3 * np.pi / 4\n\ndef lorenz(xyz, t):\n    x, y, z = xyz\n    x_dot = sigma * (y - x)\n    y_dot = x * rho - x * z - y\n    z_dot = x * y - beta* z\n    return [x_dot, y_dot, z_dot]\n\ninitial = (-10, -7, 35)\nt = np.arange(0, 100, 0.006)\n\nsolution = odeint(lorenz, initial, t)\n\nx = solution[:, 0]\ny = solution[:, 1]\nz = solution[:, 2]\nxprime = np.cos(theta) * x - np.sin(theta) * y\n\ncolors = [\"#C6DBEF\", \"#9ECAE1\", \"#6BAED6\", \"#4292C6\", \"#2171B5\", \"#08519C\", \"#08306B\",]\n\np = figure(title=\"lorenz example\")\n\np.multi_line(np.array_split(xprime, 7), np.array_split(z, 7),\n             line_color=colors, line_alpha=0.8, line_width=1.5)\n\n\nshow(p)  # open a browser\n\nz = ZBAK # Zeppelin bug\n","user":"anonymous","dateUpdated":"2017-02-25T11:29:03+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685950_609929209","id":"20170221-200421_395267022","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:29:03+0100","dateFinished":"2017-02-25T11:29:05+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18561"},{"text":"%pyspark\nfrom bokeh.models import HoverTool, ColumnDataSource\nfrom bokeh.plotting import figure, show\nfrom bokeh.sampledata.periodic_table import elements\n\nromans = [\"I\", \"II\", \"III\", \"IV\", \"V\", \"VI\", \"VII\"]\n\nelements = elements.copy()\nelements[\"atomic mass\"] = elements[\"atomic mass\"].astype(str)\n\nelements[\"period\"] = [romans[x-1] for x in elements.period]\nelements = elements[elements.group != \"-\"]\n\ngroup_range = [str(x) for x in range(1, 19)]\n\ncolormap = {\n    \"alkali metal\"         : \"#a6cee3\",\n    \"alkaline earth metal\" : \"#1f78b4\",\n    \"halogen\"              : \"#fdbf6f\",\n    \"metal\"                : \"#b2df8a\",\n    \"metalloid\"            : \"#33a02c\",\n    \"noble gas\"            : \"#bbbb88\",\n    \"nonmetal\"             : \"#baa2a6\",\n    \"transition metal\"     : \"#e08e79\",\n}\n\nsource = ColumnDataSource(\n    data=dict(\n        group=[str(x) for x in elements[\"group\"]],\n        period=[str(y) for y in elements[\"period\"]],\n        symx=[str(x)+\":0.1\" for x in elements[\"group\"]],\n        numbery=[str(x)+\":0.8\" for x in elements[\"period\"]],\n        massy=[str(x)+\":0.15\" for x in elements[\"period\"]],\n        namey=[str(x)+\":0.3\" for x in elements[\"period\"]],\n        sym=elements[\"symbol\"],\n        name=elements[\"name\"],\n        cpk=elements[\"CPK\"],\n        atomic_number=elements[\"atomic number\"],\n        electronic=elements[\"electronic configuration\"],\n        mass=elements[\"atomic mass\"],\n        type=elements[\"metal\"],\n        type_color=[colormap[x] for x in elements[\"metal\"]],\n    )\n)\n\np = figure(title=\"Periodic Table\", tools=\"hover,save\",\n           x_range=group_range, y_range=list(reversed(romans)))\np.plot_width = 1200\np.toolbar_location = None\np.outline_line_color = None\n\np.rect(\"group\", \"period\", 0.9, 0.9, source=source,\n       fill_alpha=0.6, color=\"type_color\")\n\ntext_props = {\n    \"source\": source,\n    \"angle\": 0,\n    \"color\": \"black\",\n    \"text_align\": \"left\",\n    \"text_baseline\": \"middle\"\n}\n\np.text(x=\"symx\", y=\"period\", text=\"sym\",\n       text_font_style=\"bold\", text_font_size=\"15pt\", **text_props)\n\np.text(x=\"symx\", y=\"numbery\", text=\"atomic_number\",\n       text_font_size=\"9pt\", **text_props)\n\np.text(x=\"symx\", y=\"namey\", text=\"name\",\n       text_font_size=\"6pt\", **text_props)\n\np.text(x=\"symx\", y=\"massy\", text=\"mass\",\n       text_font_size=\"5pt\", **text_props)\n\np.grid.grid_line_color = None\n\np.select_one(HoverTool).tooltips = [\n    (\"name\", \"@name\"),\n    (\"atomic number\", \"@atomic_number\"),\n    (\"type\", \"@type\"),\n    (\"atomic mass\", \"@mass\"),\n    (\"CPK color\", \"$color[hex, swatch]:cpk\"),\n    (\"electronic configuration\", \"@electronic\"),\n]\n\nshow(p)  # Change to save(p) to save but not show the HTML file","user":"anonymous","dateUpdated":"2017-02-25T11:29:07+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685950_609929209","id":"20170221-201347_1016301668","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:29:07+0100","dateFinished":"2017-02-25T11:29:08+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18562"},{"text":"%pyspark\nfrom collections import OrderedDict\nfrom math import log, sqrt\n\nimport numpy as np\nimport pandas as pd\nfrom six.moves import cStringIO as StringIO\n\nfrom bokeh.plotting import figure, show, output_file\n\nantibiotics = \"\"\"\nbacteria,                        penicillin, streptomycin, neomycin, gram\nMycobacterium tuberculosis,      800,        5,            2,        negative\nSalmonella schottmuelleri,       10,         0.8,          0.09,     negative\nProteus vulgaris,                3,          0.1,          0.1,      negative\nKlebsiella pneumoniae,           850,        1.2,          1,        negative\nBrucella abortus,                1,          2,            0.02,     negative\nPseudomonas aeruginosa,          850,        2,            0.4,      negative\nEscherichia coli,                100,        0.4,          0.1,      negative\nSalmonella (Eberthella) typhosa, 1,          0.4,          0.008,    negative\nAerobacter aerogenes,            870,        1,            1.6,      negative\nBrucella antracis,               0.001,      0.01,         0.007,    positive\nStreptococcus fecalis,           1,          1,            0.1,      positive\nStaphylococcus aureus,           0.03,       0.03,         0.001,    positive\nStaphylococcus albus,            0.007,      0.1,          0.001,    positive\nStreptococcus hemolyticus,       0.001,      14,           10,       positive\nStreptococcus viridans,          0.005,      10,           40,       positive\nDiplococcus pneumoniae,          0.005,      11,           10,       positive\n\"\"\"\n\ndrug_color = OrderedDict([\n    (\"Penicillin\",   \"#0d3362\"),\n    (\"Streptomycin\", \"#c64737\"),\n    (\"Neomycin\",     \"black\"  ),\n])\n\ngram_color = {\n    \"positive\" : \"#aeaeb8\",\n    \"negative\" : \"#e69584\",\n}\n\ndf = pd.read_csv(StringIO(antibiotics),\n                 skiprows=1,\n                 skipinitialspace=True,\n                 engine='python')\n\nwidth = 800\nheight = 800\ninner_radius = 90\nouter_radius = 300 - 10\n\nminr = sqrt(log(.001 * 1E4))\nmaxr = sqrt(log(1000 * 1E4))\na = (outer_radius - inner_radius) / (minr - maxr)\nb = inner_radius - a * maxr\n\ndef rad(mic):\n    return a * np.sqrt(np.log(mic * 1E4)) + b\n\nbig_angle = 2.0 * np.pi / (len(df) + 1)\nsmall_angle = big_angle / 7\n\np = figure(plot_width=width, plot_height=height, title=\"\",\n    x_axis_type=None, y_axis_type=None,\n    x_range=(-420, 420), y_range=(-420, 420),\n    min_border=0, outline_line_color=\"black\",\n    background_fill_color=\"#f0e1d2\", border_fill_color=\"#f0e1d2\",\n    toolbar_sticky=False)\n\np.xgrid.grid_line_color = None\np.ygrid.grid_line_color = None\n\n# annular wedges\nangles = np.pi/2 - big_angle/2 - df.index.to_series()*big_angle\ncolors = [gram_color[gram] for gram in df.gram]\np.annular_wedge(\n    0, 0, inner_radius, outer_radius, -big_angle+angles, angles, color=colors,\n)\n\n# small wedges\np.annular_wedge(0, 0, inner_radius, rad(df.penicillin),\n                -big_angle+angles+5*small_angle, -big_angle+angles+6*small_angle,\n                color=drug_color['Penicillin'])\np.annular_wedge(0, 0, inner_radius, rad(df.streptomycin),\n                -big_angle+angles+3*small_angle, -big_angle+angles+4*small_angle,\n                color=drug_color['Streptomycin'])\np.annular_wedge(0, 0, inner_radius, rad(df.neomycin),\n                -big_angle+angles+1*small_angle, -big_angle+angles+2*small_angle,\n                color=drug_color['Neomycin'])\n\n# circular axes and lables\nlabels = np.power(10.0, np.arange(-3, 4))\nradii = a * np.sqrt(np.log(labels * 1E4)) + b\np.circle(0, 0, radius=radii, fill_color=None, line_color=\"white\")\np.text(0, radii[:-1], [str(r) for r in labels[:-1]],\n       text_font_size=\"8pt\", text_align=\"center\", text_baseline=\"middle\")\n\n# radial axes\np.annular_wedge(0, 0, inner_radius-10, outer_radius+10,\n                -big_angle+angles, -big_angle+angles, color=\"black\")\n\n# bacteria labels\nxr = radii[0]*np.cos(np.array(-big_angle/2 + angles))\nyr = radii[0]*np.sin(np.array(-big_angle/2 + angles))\nlabel_angle=np.array(-big_angle/2+angles)\nlabel_angle[label_angle < -np.pi/2] += np.pi # easier to read labels on the left side\np.text(xr, yr, df.bacteria, angle=label_angle,\n       text_font_size=\"9pt\", text_align=\"center\", text_baseline=\"middle\")\n\n# OK, these hand drawn legends are pretty clunky, will be improved in future release\np.circle([-40, -40], [-370, -390], color=list(gram_color.values()), radius=5)\np.text([-30, -30], [-370, -390], text=[\"Gram-\" + gr for gr in gram_color.keys()],\n       text_font_size=\"7pt\", text_align=\"left\", text_baseline=\"middle\")\n\np.rect([-40, -40, -40], [18, 0, -18], width=30, height=13,\n       color=list(drug_color.values()))\np.text([-15, -15, -15], [18, 0, -18], text=list(drug_color),\n       text_font_size=\"9pt\", text_align=\"left\", text_baseline=\"middle\")\n\n\nshow(p)","user":"anonymous","dateUpdated":"2017-02-25T11:29:11+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685950_609929209","id":"20170221-201443_71602227","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:29:11+0100","dateFinished":"2017-02-25T11:29:11+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18563"},{"text":"%pyspark\nfrom bokeh.io import show\nfrom bokeh.models import (\n    ColumnDataSource,\n    HoverTool,\n    LogColorMapper\n)\nfrom bokeh.palettes import Viridis6 as palette\nfrom bokeh.plotting import figure\n\nfrom bokeh.sampledata.us_counties import data as counties\nfrom bokeh.sampledata.unemployment import data as unemployment\n\npalette.reverse()\n\ncounties = {\n    code: county for code, county in counties.items() if county[\"state\"] == \"tx\"\n}\n\ncounty_xs = [county[\"lons\"] for county in counties.values()]\ncounty_ys = [county[\"lats\"] for county in counties.values()]\n\ncounty_names = [county['name'] for county in counties.values()]\ncounty_rates = [unemployment[county_id] for county_id in counties]\ncolor_mapper = LogColorMapper(palette=palette)\n\nsource = ColumnDataSource(data=dict(\n    x=county_xs,\n    y=county_ys,\n    name=county_names,\n    rate=county_rates,\n))\n\nTOOLS = \"pan,wheel_zoom,box_zoom,reset,hover,save\"\n\np = figure(\n    title=\"Texas Unemployment, 2009\", tools=TOOLS,\n    x_axis_location=None, y_axis_location=None\n)\np.grid.grid_line_color = None\n\np.patches('x', 'y', source=source,\n          fill_color={'field': 'rate', 'transform': color_mapper},\n          fill_alpha=0.7, line_color=\"white\", line_width=0.5)\n\nhover = p.select_one(HoverTool)\nhover.point_policy = \"follow_mouse\"\nhover.tooltips = [\n    (\"Name\", \"@name\"),\n    (\"Unemployment rate)\", \"@rate%\"),\n    (\"(Long, Lat)\", \"($x, $y)\"),\n]\n\nshow(p)","user":"anonymous","dateUpdated":"2017-02-25T11:29:15+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685951_609544460","id":"20170221-201647_822343580","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:29:15+0100","dateFinished":"2017-02-25T11:29:17+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18564"},{"text":"%pyspark\nimport pandas as pd\nfrom bokeh.charts import output_file, Chord\nfrom bokeh.io import show\nfrom bokeh.sampledata.les_mis import data\n\nnodes = data['nodes']\nlinks = data['links']\n\nnodes_df = pd.DataFrame(nodes)\nlinks_df = pd.DataFrame(links)\n\nsource_data = links_df.merge(nodes_df, how='left', left_on='source', right_index=True)\nsource_data = source_data.merge(nodes_df, how='left', left_on='target', right_index=True)\nsource_data = source_data[source_data[\"value\"] > 5]\n\nchord_from_df = Chord(source_data, source=\"name_x\", target=\"name_y\", value=\"value\")\n\nshow(chord_from_df)","user":"anonymous","dateUpdated":"2017-02-25T11:29:20+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487765685951_609544460","id":"20170221-201723_953579164","dateCreated":"2017-02-22T13:14:45+0100","dateStarted":"2017-02-25T11:29:20+0100","dateFinished":"2017-02-25T11:29:20+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18565"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-02-25T11:29:35+0100","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1487848418748_-936443955","id":"20170223-121338_2133412796","dateCreated":"2017-02-23T12:13:38+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:18566"}],"name":"JupyterShim Bokeh Gallery","id":"2CA2PRGXE","angularObjects":{"2C8CW5MV1:shared_process":[],"2CBEDQHXY:shared_process":[],"2C97UNR7H:shared_process":[],"2C9CWX9EW:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}